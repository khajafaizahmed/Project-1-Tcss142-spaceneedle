<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TCSS 142 · Project 1 Space Needle Tester</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{
  font-family:system-ui,sans-serif;
  background:#0b0620;
  color:#f5f5ff;
  margin:0;
  padding:40px;
}
h1{margin-top:0}
textarea{
  width:100%;
  height:420px;
  background:#101528;
  color:#e6ebff;
  border:1px solid #444;
  border-radius:8px;
  padding:12px;
  font-family:monospace;
}
button{
  margin-top:12px;
  padding:10px 16px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:600;
}
#run{background:#e8e3d3;color:#20113f}

.card{margin-top:20px;padding:16px;border-radius:10px}
.ok{background:#102a18;border:1px solid #2bd67b}
.err{background:#2a1010;border:1px solid #ff5d5d}
.warn{background:#2a240e;border:1px solid #ffcc4d}

pre{white-space:pre-wrap}

table{
  margin-top:10px;
  border-collapse:collapse;
}
th,td{
  padding:6px 10px;
  border:1px solid #444;
  vertical-align:top;
}

.hint{margin-top:10px;font-size:13px;opacity:.9}
</style>
</head>
<body>

<h1>TCSS 142 · Project 1 Space Needle Tester</h1>
<p>Paste <b>Project1.java</b> and run the checker.</p>

<textarea id="code" placeholder="Paste Project1.java here..."></textarea>
<br>
<button id="run">Run Tests</button>

<div id="out" class="card"></div>

<script>
const runBtn=document.getElementById("run");
const out=document.getElementById("out");
const codeEl=document.getElementById("code");

runBtn.onclick=async()=>{
  out.textContent="Running tests...";
  const res=await fetch("/run",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({code:codeEl.value})
  });
  render(await res.text());
};

function esc(s){
  return s.replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c]));
}

function render(t){
  out.className="card";
  if(t.startsWith("STATUS:PASS")){
    out.classList.add("ok");
    out.innerHTML="✅ <b>All checks passed.</b><br>Your Space Needle matches exactly.";
    return;
  }
  if(t.startsWith("STATUS:COMPILE_ERROR")){
    out.classList.add("err");
    out.innerHTML="<b>❌ Compilation failed</b><pre>"+esc(t)+"</pre>";
    return;
  }
  if(t.startsWith("STATUS:LINE_COUNT")){
    const e=t.match(/EXPECTED:(\d+)/)[1];
    const g=t.match(/GOT:(\d+)/)[1];
    out.classList.add("warn");
    out.innerHTML=`⚠️ Line count mismatch<br>Expected ${e}, got ${g}
    <div class="hint">Hint: check loop bounds.</div>`;
    return;
  }
  if(t.startsWith("STATUS:MISMATCH")){
    const l=t.match(/LINE:(\d+)/)[1];
    const e=t.match(/EXPECTED:(.*)/)[1];
    const g=t.match(/GOT:(.*)/)[1];
    out.classList.add("warn");
    out.innerHTML=`
      ⚠️ Output mismatch at line <b>${l}</b>
      <table>
        <tr><th>Expected</th><td><pre>${esc(e)}</pre></td></tr>
        <tr><th>Your output</th><td><pre>${esc(g)}</pre></td></tr>
      </table>
      <div class="hint">Hint: spacing and repeated characters must match exactly.</div>
    `;
    return;
  }
  if(t.startsWith("STATUS:TIMEOUT")){
    out.classList.add("err");
    out.innerHTML="⏱️ Program timed out. Check for infinite loops.";
    return;
  }
  out.textContent=t;
}
</script>

</body>
</html>
